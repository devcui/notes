## oidc-provider

- Let's look at oidc-provider bit by bit.
## lib/provider.js

```javascript
constructor(issuer, setup) {
	assert(issuer, 'first argument must be the Issuer Identifier, i.e. https://op.example.com');
	assert.equal(typeof issuer, 'string', 'Issuer Identifier must be a string');
    assert(isWebUri(issuer), 'Issuer Identifier must be a valid web uri');
	const {
      pathname, host, protocol, search, hash, href,
    } = new URL(issuer);
    assert(host, 'Issuer Identifier must have a host component');
    assert(protocol, 'Issuer Identifier must have an URI scheme component');
    assert(!search && !href.endsWith('?'), 'Issuer Identifier must not have a query component');
    assert(!hash && !href.endsWith('#'), 'Issuer Identifier must not have a fragment component');
}
```

- determine the URL of the issuer, which is the issuing agency

```javascript
super();
```

- Calling KOA's constructor

```javascript
const configuration = new Configuration(setup);

class Configuration {
  #defaults = getDefaults();

  constructor(config) {
    Object.assign(this, merge({}, this.#defaults, pick(config, ...Object.keys(this.#defaults))));
    ...
}
```

- Use the default configuration and the passed-in config to merge, then expand the configuration object and fill it all into this, which is an instance of the Config class